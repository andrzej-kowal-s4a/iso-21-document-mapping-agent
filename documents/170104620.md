# S4A License Tracking and Update Procedure

**Source URL:** https://smart4aviation.atlassian.net/wiki/spaces/S4A/pages/170104620
**Page ID:** 170104620
**Version:** 39

---

|  |  |
| --- | --- |
| **Type Of Document** | Procedure |
| **Policy Owner** | Director Sales & Marketing |
| **Author** | @Maciej Migacz |
| **Approvals** | @Ivo Hop  @Maciej Migacz  @Andrzej Kowal  @Wojciech Przybylski  @Pawe≈Ç Wadas (Unlicensed) |
| **Effective From** | Immediately after publishing |
| **Linked policies / procedures / standards / guidelines** |  |
| **Review Lifecycle** | Review period: 1y or whenever important reasons arise  SAS-15058b6fd100-5a64-3d8f-8f9d-41b95d1c8c85System Jira |
| **Company** | (all)  AzimuthIT Sp. z o.o. Sp.k.  AzimuthIT Sp. z o.o.  Smart4Aviation Technologies B.V. |
| **Version** |  |

**Policy purpose**
------------------

To properly maintain and track Smart4Aviation's software licenses, installed on Customer and/or Smart4Aviation environments as well as to protect Smart4Aviation's intellectual property.

To do so, Smart4Aviation needs to follow a process of the license tracking and update procedure. The main purpose of this procedure is to establish terms and conditions related to the proper tracking of the Smart4Aviation licenses based on the Agreements concluded between Smart4Aviation and its Customers and the conditions as well as internal assumptions for Smart4Aviation internal environments.

**Scope**
---------

This procedure is applicable to the whole company, but primarily pertains to:

* Smart4Aviation's Sales Team to provide the contractual conditions related to purchased Smart4Aviation's licenses and their subsequent renewal
* Smart4Aviation's IT Personnel to generate, maintain and update License

**Stakeholders**
----------------

The main stakeholders of the policy are:

* Sales S4A Personnel dedicated for contracting: Sales Director, KAMs, CFO
* IT S4A Personnel to generate, maintain and update License
* S4A Personnel to receive a License to use S4A Products for internal purposes (development, testing, demo, etc.)
* Customers which have a valid Agreement

**Terms and Conditions**
------------------------

General Conditions:

1. License should apply to all environments for all Customer installations and internal one, starting from S4A Smart Suite 2020.1.31 (bootstrap 5.1.40+, svcreg 5.1.11+, Smart CORE 3.15.**43,** eForms 2.5.20)
2. License will have a required License Expiration Date provided for each installation/customer.
3. License includes the following mechanism to notify the user about the License Expiration Date in the form of:

   1. Application warn in application logs - on a daily basis starting from 30 days prior to the License Expiration Date
   2. Message on the application GUI (as per RFC-16678b6fd100-5a64-3d8f-8f9d-41b95d1c8c85System Jira) starting from 14 days prior to the License Expiration Date
   3. Application error in application logs - on a daily basis starting from 7 days prior to the License Expiration Date
   4. License status will be available in the application health check INTBOOT-3628b6fd100-5a64-3d8f-8f9d-41b95d1c8c85System Jira
4. If License will not be extended the applications will stop working.

Process of generating the License:

1. Person who creates a new environment or maintains existing environment have to request and apply valid License.
2. Basing on information from /wiki/spaces/S4A/pages/170104011, a requestor shall prepare License request according to procedure described here: /wiki/spaces/S4A/pages/141526287.
3. License to be applied on the environment by IT Personnel (S4A administrator in case of environments S4A has access to or Customer IT in case S4A has no access to the given environment). Follow this procedure: /wiki/spaces/ARCH/pages/141526229
4. License to be applied not only on production environment, but on all environments (test, pre-prod, DR, development, etc.)
5. License shall be recorded also in the Jira to enable proper extension process:

   1. Project=LICENSE
   2. Type = License
   3. Summary = "Time-based license for S4A Products for $environment\_name$"
   4. License

      = put here generated license
   5. Expiration Date = granted validity date
   6. Reminder Period = 1 month
   7. Owner = put here person who will be responsible for license extension (IC in case of projects or Support Care-taker in case of project in support mode)

Process of upgrading the License:

1. License Jira owner will be notified one month before license expiration date
2. New license shall be requested according to the procedure /wiki/spaces/S4A/pages/141526287
3. License owner should contact customer and agree license deployment (execution of sql script on database level, app restart is not needed). Make sure you will follow the BT procedure for production environments.
4. Development license will be included in internal libraries (svcreg) and will be valid ~4 months from the library release date.
5. Follow /wiki/spaces/ARCH/pages/141526229 procedure to apply it

Process of informing Customer about the License Policy 

Existing Customers (during major upgrade):

* In the new version of the Application Suite (starting from Smart CORE 3.15.43), Smart4Aviation implemented the License Tracking mechanism which allows Smart4Aviation to maintain licenses granted to the Customer based on the valid Agreement. Each License has a required License Expiration Date which in most cases is equal to the Customer contract validity date.   
  The following mechanism is implemented in order to notify the Customer about the expired license:  
  - 30 days prior to the License Expiration Date, Smart4Aviation Application will start raising a warning in the application logs.

  2021-02-02T11:01:49,290Z [773d7bcfea5dddd9/773d7bcfea5dddd9] WARN [pl.azimuthit.bootstrap.svcreg.e] (QRTZ-LocalThread-smart-core-core\_node\_cert\_app1\_01-1647-SynchronizeSuiteTask) License LicenseHolder[License[ApplicationName[smart suite], issuedBy=Smart4Aviation, issuedOnUtc=2020-11-05T14:50:54.354
  issuedFor=S4A Development/SVCREG/5.1.15, optionalValidTill=Optional.of(2021-02-13T15:50:54.390)
  configuration={}]]will expire in: P1W4DT4H49M5.101S. Make sure you have updated licence before this time!

  - 15 days prior to the License Expiration Date message on the application GUI will be displayed.   
  - 7 days prior to the License Expiration Date, Smart4Aviation Application will start raising an error in the application logs.

  If the License will not be extended, the Application Suite will stop working.

  If the applicable License will be extended on the contract level, the new License for the Application Suite will be upgraded on each of the Customer's environment by the Smart4Aviation IT Administrator. Upgrade of the License does not require application restart, therefore it will not impact the User's daily operations.

  Smart4Aviation will be responsible for the entire license upgrade process therefore no action will be required on the Customer side, but we feel responsible for informing you about such a change and the entire process.

New Customers (contract clause):

* Even if the agreement does not explicitly provide for such authority, the SUPPLIER shall be permitted to install technical provisions for the purpose of protecting the software, hardware, data files, websites and suchlike in relation to an agreed restriction on the content or the term of the right to use these objects. The Client shall under no circumstances be permitted to remove or circumvent such technical provisions or to arrange for this to be carried out.

**License assumptions**
-----------------------

| **Environment Type** | **Importance** | **License Owner** | **License Conditions** |
| --- | --- | --- | --- |
| Customer environment managed by Customer | Critical | @Maciej Migacz | According to Agreement or information provided by Sales Director |
| Customer environment managed by Smart4Aviation | Low | @Maciej Migacz | According to Agreement or information provided by Sales Director |
| Smart4Aviation internal environments | Low | @Andrzej Kowal | Information provided by CIO. |

**Q&A**
-------

1. How to check in logs if license has already expired?

   1. grep -A4 "ERROR.\*.LICENSE VERIFICATION FAILURE" warn.log
      Results:
      2021-02-16T09:52:59,029Z [/] ERROR [pl.azimuthit.bootstrap.spring.singleton.BootstrapSpringContextSingleton] (ServerService Thread Pool -- 79-init:/shell-WebApplicationId[smart-shell-war](ModuleVersion[2.16.29])) Error initializing BOOTSTRAP context due to: LICENSE VERIFICATION FAILURE: LicenseHolder[License[ApplicationName[smart suite], issuedBy=Smart4Aviation, issuedOnUtc=2020-11-05T14:50:54.354
      issuedFor=S4A Development/SVCREG/5.1.15, optionalValidTill=Optional.of(2021-02-13T15:50:54.390)
      configuration={}]]- SUITE license was valid till: 2021-02-13T15:50:54.390, now is: 2021-02-16T09:52:58.963: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'suiteLicenseFacade' defined in class path resource [pl/azimuthit/bootstrap/svcreg/license/LicenseSpringConfiguration.class]: Instantiation of bean failed; nested exception is org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [pl.azimuthit.bootstrap.svcreg.e pl.azimuthit.bootstrap.svcreg.license.LicenseSpringConfiguration.suiteLicenseHolder(pl.azimuthit.bootstrap.svcreg.d)] threw exception; nested exception is java.lang.IllegalStateException: LICENSE VERIFICATION FAILURE: LicenseHolder[License[ApplicationName[smart suite], issuedBy=Smart4Aviation, issuedOnUtc=2020-11-05T14:50:54.354
      issuedFor=S4A Development/SVCREG/5.1.15, optionalValidTill=Optional.of(2021-02-13T15:50:54.390)
      configuration={}]]- SUITE license was valid till: 2021-02-13T15:50:54.390, now is: 2021-02-16T09:52:58.963
      or
      2021-02-16T09:54:46,401Z [/] ERROR [org.jboss.msc.service.fail] (ServerService Thread Pool -- 99) MSC000001: Failed to start service jboss.deployment.subunit."smart-core-ear-3.15.51.ear"."core-svc.war".undertow-deployment: org.jboss.msc.service.StartException in service jboss.deployment.subunit."smart-core-ear-3.15.51.ear"."core-svc.war".undertow-deployment: java.lang.RuntimeException: java.lang.IllegalStateException: Error initializing BOOTSTRAP context due to: LICENSE VERIFICATION FAILURE: LicenseHolder[License[ApplicationName[smart suite], issuedBy=Smart4Aviation, issuedOnUtc=2020-11-05T14:50:54.354
      issuedFor=S4A Development/SVCREG/5.1.15, optionalValidTill=Optional.of(2021-02-13T15:50:54.390)
      configuration={}]]- SUITE license was valid till: 2021-02-13T15:50:54.390, now is: 2021-02-16T09:54:45.848
      at org.wildfly.extension.undertow.deployment.UndertowDeploymentService$1.run(UndertowDeploymentService.java:81)
      at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
2. How to check in logs till when my license is valid?

   1. grep -A2 pl.azimuthit.util.license.LicenseHolder server.log
      Results - check optionalValidTill=Optional.of:
      2021-02-16T10:17:13,878Z [/] INFO [pl.azimuthit.util.license.LicenseHolder] (ServerService Thread Pool -- 71) Created license holder with: License[ApplicationName[smart suite], issuedBy=Smart4Aviation, issuedOnUtc=2021-01-29T08:27:15.233
      issuedFor=S4A Development/SVCREG/5.1.15, optionalValidTill=Optional.of(2021-05-09T09:27:15.287)
      configuration={}]
3. Q

